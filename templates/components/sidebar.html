<nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            <!-- Dashboard -->
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}" href="{% url 'contabilidade:dashboard' %}">
                    <i class="bi bi-speedometer2 me-2"></i>
                    Dashboard
                </a>
            </li>

            <!-- Empresas -->
            <li class="nav-item">
                <a class="nav-link {% if 'empresa' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'contabilidade:empresa_list' %}">
                    <i class="bi bi-building me-2"></i>
                    Empresas
                </a>
            </li>

            <!-- Sessoes -->
            <li class="nav-item">
                <a class="nav-link {% if 'sessao' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'contabilidade:sessao_list' %}">
                    <i class="bi bi-chat-dots me-2"></i>
                    Sessões
                </a>
            </li>

            <!-- Notas Fiscais -->
            <li class="nav-item">
                <a class="nav-link {% if 'nota_fiscal' in request.resolver_match.url_name or 'emissao' in request.resolver_match.url_name or 'processada' in request.resolver_match.url_name or 'tomador' in request.resolver_match.url_name or 'consulta_cnpj' in request.resolver_match.url_name %}active{% endif %}" 
                   data-bs-toggle="collapse" 
                   href="#notasFiscaisSubmenu" 
                   role="button" 
                   aria-expanded="false">
                    <i class="bi bi-file-earmark-text me-2"></i>
                    Notas Fiscais
                    <i class="bi bi-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if 'nota_fiscal' in request.resolver_match.url_name or 'emissao' in request.resolver_match.url_name or 'processada' in request.resolver_match.url_name or 'tomador' in request.resolver_match.url_name or 'consulta_cnpj' in request.resolver_match.url_name %}show{% endif %}" id="notasFiscaisSubmenu">
                    <ul class="nav flex-column ms-3">
                        <li class="nav-item">
                            <a class="nav-link py-1 {% if 'emissao_list' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'nfse:emissao_list' %}">
                                <i class="bi bi-list-check me-2"></i>
                                Emissões
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-1 {% if 'processada_list' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'nfse:processada_list' %}">
                                <i class="bi bi-file-earmark-check me-2"></i>
                                Processadas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-1 {% if 'tomador_list' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'nfse:tomador_list' %}">
                                <i class="bi bi-person-badge me-2"></i>
                                Clientes Tomadores
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-1 {% if 'consulta_cnpj' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'nfse:consulta_cnpj' %}">
                                <i class="bi bi-search me-2"></i>
                                Consultar CNPJ
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-1 {% if 'nota_fiscal_list' in request.resolver_match.url_name %}active{% endif %}" 
                               href="{% url 'contabilidade:nota_fiscal_list' %}">
                                <i class="bi bi-file-earmark-text me-2"></i>
                                Rascunhos
                            </a>
                        </li>
                    </ul>
                </div>
            </li>

            <li class="nav-item mt-3">
                <small class="nav-link text-muted text-uppercase fw-bold" style="font-size: 0.7rem; letter-spacing: 0.1em;">
                    Administração
                </small>
            </li>

            <!-- Usuarios do Sistema -->
            <li class="nav-item">
                <a class="nav-link {% if 'usuario' in request.resolver_match.url_name and 'empresa' not in request.resolver_match.url_name %}active{% endif %}" href="{% url 'contabilidade:usuario_list' %}">
                    <i class="bi bi-people me-2"></i>
                    Usuários
                </a>
            </li>

            <!-- Configuracoes -->
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="bi bi-gear me-2"></i>
                    Configurações
                </a>
            </li>
        </ul>

        <!-- Info Footer -->
        <div class="mt-4 px-3">
            <div class="card bg-transparent border-secondary">
                <div class="card-body py-2 px-3">
                    <small class="text-muted d-block">Contabilidade</small>
                    <span class="text-primary small">
                        {% if user.contabilidade %}
                            {{ user.contabilidade|truncatechars:20 }}
                        {% else %}
                            Não vinculado
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</nav>
